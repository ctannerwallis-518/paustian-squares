<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Football Squares</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    h1 {
      text-align: center;
    }
    .counts {
      text-align: center;
      margin-bottom: 15px;
      font-weight: bold;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(11, 1fr);
      max-width: 700px;
      margin: 0 auto;
      gap: 2px;
    }
    .grid-header {
      background: #333;
      color: white;
      padding: 6px;
      text-align: center;
      font-size: 12px;
    }
    .square {
      background: white;
      border: 1px solid #ccc;
      height: 50px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
    }
    .square.confirmed {
      background: #c8f7c5;
      cursor: not-allowed;
    }
    .square.pending {
      background: #ffeaa7;
      cursor: not-allowed;
    }
    .form {
      max-width: 400px;
      margin: 25px auto;
      background: white;
      padding: 15px;
      border-radius: 4px;
    }
    .form input, .form button {
      width: 100%;
      padding: 8px;
      margin-top: 8px;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:disabled {
      background: #999;
      cursor: not-allowed;
    }
  </style>
</head>

<body>
  <h1>Football Squares</h1>

  <div class="counts">
    Confirmed: <span id="confirmedCount">0</span>/100 |
    Pending: <span id="pendingCount">0</span>
  </div>

  <div id="grid" class="grid"></div>

  <div class="form">
    <input id="nameInput" placeholder="Your name" />
    <input id="squaresInput" placeholder="Squares (e.g. 5-5;6-2)" />
    <button id="submitBtn">Submit Squares</button>
  </div>

<script>
const CONFIG = {
  SHEET_ID: '1NUqMM7igQf71rk0f9j-MPM3DJculA-kW25Xza0Z8SOQ',
  API_KEY: 'AIzaSyD_aMYuNWr-4Eic80rW2rvRDogHpxOwoow',
  FORM_URL: 'https://docs.google.com/forms/d/e/1FAIpQLSe5qOGy7WELZLfz7nMRu5eqjFott9wBRwawo8ZEBGP3fpX_HA/formResponse',
  FORM_FIELDS: {
    name: 'entry.338392548',
    squares: 'entry.2075961659'
  }
};

const gridEl = document.getElementById('grid');
const confirmedCountEl = document.getElementById('confirmedCount');
const pendingCountEl = document.getElementById('pendingCount');

let confirmed = {};
let pending = {};

async function fetchData() {
  const sheets = [
    'Confirmed!A2:B',
    'Form Responses 1!B2:C'
  ];

  const baseUrl = `https://sheets.googleapis.com/v4/spreadsheets/${CONFIG.SHEET_ID}/values:batchGet`;
  const ranges = sheets.map(s => `ranges=${encodeURIComponent(s)}`).join('&');
  const url = `${baseUrl}?${ranges}&key=${CONFIG.API_KEY}`;

  const res = await fetch(url);
  const data = await res.json();

  confirmed = {};
  pending = {};

  const confirmedRows = data.valueRanges[0].values || [];
  confirmedRows.forEach(r => {
    confirmed[r[0]] = r[1];
  });

  const pendingRows = data.valueRanges[1].values || [];
  pendingRows.forEach(r => {
    pending[r[1]] = r[0];
  });

  renderGrid();
}

function renderGrid() {
  let confirmedCount = Object.keys(confirmed).length;
  let pendingCount = Object.keys(pending).length;

  confirmedCountEl.textContent = confirmedCount;
  pendingCountEl.textContent = pendingCount;

  let html = '';

  html += `<div></div>`;
  for (let c = 0; c < 10; c++) {
    html += `<div class="grid-header">${c}</div>`;
  }

  for (let r = 0; r < 10; r++) {
    html += `<div class="grid-header">${r}</div>`;
    for (let c = 0; c < 10; c++) {
      const key = `${r}-${c}`;
      let cls = 'square';
      let label = '';

      if (confirmed[key]) {
        cls += ' confirmed';
        label = confirmed[key];
      } else if (pending[key]) {
        cls += ' pending';
        label = 'Pending';
      }

      html += `<div class="${cls}" data-key="${key}">${label}</div>`;
    }
  }

  gridEl.innerHTML = html;

  document.querySelectorAll('.square').forEach(el => {
    el.addEventListener('click', () => {
      const key = el.dataset.key;
      if (confirmed[key]) {
        alert(`This square belongs to: ${confirmed[key]}`);
      } else if (pending[key]) {
        alert(`This square is pending for: ${pending[key]}`);
      }
    });
  });
}

document.getElementById('submitBtn').addEventListener('click', async () => {
  const name = document.getElementById('nameInput').value.trim();
  const squares = document.getElementById('squaresInput').value.trim();

  if (!name || !squares) {
    alert('Please enter name and squares.');
    return;
  }

  const formData = new FormData();
  formData.append(CONFIG.FORM_FIELDS.name, name);
  formData.append(CONFIG.FORM_FIELDS.squares, squares);

  await fetch(CONFIG.FORM_URL, {
    method: 'POST',
    mode: 'no-cors',
    body: formData
  });

  alert('Submission sent!');
  document.getElementById('squaresInput').value = '';
});

fetchData();
setInterval(fetchData, 30000);
</script>
</body>
</html>
